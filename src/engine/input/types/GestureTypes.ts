// ======================================================
// HandFrame：单帧手部状态快照（Hand State Snapshot）
// ======================================================
//
// 设计目标：
// - 用一个“尽量小但语义完整”的结构描述某一时刻的手部状态
// - 不绑定具体算法 / 插件 / 渲染逻辑
// - 作为 GestureEngine / 插件系统之间的通用输入
//
// 设计原则：
// - 轻量（每帧高频创建）
// - 可扩展（后续可添加 handedness / worldLandmarks / velocity 等）
// - 语义优先于原始模型输出（不是直接暴露 MediaPipe 原始结构）
//
// 坐标系统总体约定（IMPORTANT）：
// - 所有坐标均为“归一化坐标”
// - x, y ∈ [0, 1]，相对于输入图像/画面尺寸
// - z 为“相对深度”，无物理单位，仅用于相对比较
//
// 生命周期说明：
// - HandFrame 通常由输入层（如 MediaPipe Hands）在每一帧生成
// - 经预处理（平滑、归一化、特征提取）后传入 GestureEngine
// - 不应在插件中被修改（推荐视为只读）
// ======================================================


/**
 * Vec2：二维向量类型
 *
 * 使用场景：
 * - 屏幕/画面坐标
 * - 手心中心点
 * - 2D 平面上的位移、方向计算
 *
 * 坐标约定：
 * - x：水平方向（左 → 右）
 * - y：垂直方向（上 → 下）
 */
export type Vec2 = { x: number; y: number };

/**
 * Vec3：三维向量类型
 *
 * 使用场景：
 * - 手部关键点（landmarks）
 * - 包含深度信息的空间点
 *
 * 坐标约定（与 MediaPipe Hands 一致的隐式假设）：
 * - x, y：归一化屏幕坐标
 * - z：
 *   - 相对深度（relative depth）
 *   - 通常以 wrist 附近为参考
 *   - 数值越小通常表示“越靠近摄像头”（取决于模型实现）
 */
export type Vec3 = { x: number; y: number; z: number };


/**
 * HandFrame：描述“某一只手在某一时刻”的状态
 *
 * 注意：
 * - 一个 HandFrame ≠ 一个人
 * - 如果同时检测到双手，通常会生成两个 HandFrame
 * - HandFrame 本身不包含“这是第几只手”的全局信息
 */
export type HandFrame = {

    /**
     * landmarks：手部 21 个关键点
     *
     * 来源：
     * - 通常直接来自 MediaPipe Hands 的 landmarks 输出
     *
     * 数量与顺序：
     * - 固定长度为 21
     * - 顺序隐式遵循 MediaPipe Hands 官方定义
     *   （wrist / thumb / index / middle / ring / pinky）
     *
     * 数值语义：
     * - x, y ∈ [0, 1]：归一化图像坐标
     * - z：相对深度，无物理单位
     *
     * 使用注意：
     * - 本类型不强制 landmarks.length === 21
     * - 调用方/构造方需自行保证结构正确
     */
    landmarks: Vec3[];

    /**
     * center：手心 / 手掌中心点
     *
     * 计算方式（隐式约定）：
     * - 通常是多个关键点（如 wrist + MCP 点）的平均
     * - 并非模型直接输出，而是派生特征
     *
     * 用途：
     * - 作为整只手的代表位置
     * - 用于平移、跟随、拖拽等交互
     *
     * 坐标：
     * - 归一化 2D 坐标（0..1）
     */
    center: Vec2;

    /**
     * size：手的“尺度”近似值
     *
     * 计算方式（当前约定）：
     * - wrist → middle_finger_tip 的欧氏距离
     *
     * 设计动机：
     * - 用一个标量近似手在画面中的大小
     * - 可用于：
     *   - 缩放归一化
     *   - 判断手远近
     *   - 交互灵敏度自适应
     *
     * 数值特性：
     * - 归一化数值（与画面尺寸无关）
     * - 非物理尺寸，仅用于相对比较
     */
    size: number;

    /**
     * pinch：捏合程度（Pinch Strength）
     *
     * 定义：
     * - 0 → 完全张开
     * - 1 → 完全捏紧
     *
     * 计算方式（隐式）：
     * - 通常基于 thumb_tip 与 index_tip 的距离
     * - 经归一化 + clamp 后映射到 [0, 1]
     *
     * 使用场景：
     * - 点击 / 抓取 / 确认
     * - 连续控制（如缩放、强度）
     *
     * 注意：
     * - 这是一个“语义特征”，不是原始模型输出
     * - 不同实现对 pinch 的定义可能不同
     */
    pinch: number;

    /**
     * t：时间戳
     *
     * 单位：
     * - 秒（seconds）
     *
     * 来源：
     * - 通常来自 performance.now() / video time / 自己维护的时间轴
     *
     * 用途：
     * - 速度、加速度计算
     * - 基于时间的平滑 / 插值
     * - 调试与回放
     */
    t: number;

    /**
     * handedness：左右手标识（可选）
     *
     * 值域：
     * - "Left" | "Right"
     *
     * 来源：
     * - 若底层模型（如 MediaPipe）提供 handedness 分类结果
     *
     * 设计为可选的原因：
     * - 并非所有输入源都能稳定提供
     * - 有些交互并不关心左右手
     *
     * 使用注意：
     * - 缺失时，调用方需有兜底逻辑
     */
    handedness?: "Left" | "Right";
};
